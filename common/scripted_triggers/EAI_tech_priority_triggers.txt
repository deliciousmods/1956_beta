############################################################################
#	Expert AI mod - tech prio triggers
############################################################################

EAI_prioritise_main_industry = {
	OR = {
		AND = { date > 1943.1.1 OR = { can_research = concentrated_industry5 can_research = dispersed_industry5 } 	NOT = { has_tech = concentrated_industry5 is_researching_technology = concentrated_industry5 has_tech = dispersed_industry5 is_researching_technology = dispersed_industry5 } }
		AND = { date > 1941.1.1 OR = { can_research = concentrated_industry4 can_research = dispersed_industry4 }	NOT = { has_tech = concentrated_industry4 is_researching_technology = concentrated_industry4 has_tech = dispersed_industry4 is_researching_technology = dispersed_industry4 } }
		AND = { date > 1939.1.1 OR = { can_research = concentrated_industry3 can_research = dispersed_industry3 }	NOT = { has_tech = concentrated_industry3 is_researching_technology = concentrated_industry3 has_tech = dispersed_industry3 is_researching_technology = dispersed_industry3 } }
		AND = { date > 1936.1.1 OR = { can_research = concentrated_industry2 can_research = dispersed_industry2 }	NOT = { has_tech = concentrated_industry2 is_researching_technology = concentrated_industry2 has_tech = dispersed_industry2 is_researching_technology = dispersed_industry2 } }
		AND = { date > 1936.1.1 OR = { can_research = concentrated_industry can_research = dispersed_industry }		NOT = { has_tech = concentrated_industry is_researching_technology = concentrated_industry has_tech = dispersed_industry is_researching_technology = dispersed_industry } }
	}
}

EAI_prioritise_infantry_techs = {
	OR = {
		AND = { 
			date > 1938.6.1 
			NOT = {
				has_tech = gw_artillery is_researching_technology = gw_artillery
				has_tech = interwar_artillery is_researching_technology = interwar_artillery
				has_tech = artillery1 is_researching_technology = artillery1
			}
			NOT = { check_variable = { EAI_FOCUS/LAND/infantry_design = global.EAI_A_INF_DESIGN } check_variable = { EAI_FOCUS/LAND/infantry_width = global.EAI_10W_INF_WIDTH } } 
		}

		AND = {
			date > 1938.6.1 
			NOT = {
				has_tech = infantry_weapons1 is_researching_technology = infantry_weapons1
				has_tech = infantry_weapons2 is_researching_technology = infantry_weapons2
				has_tech = improved_infantry_weapons is_researching_technology = improved_infantry_weapons
			} 
		}
		
		if = { limit = { date > 1940.1.1 OR = { EAI_medium_armor_production = yes EAI_light_armor_attachment_production = yes EAI_motorized_attachment_production = yes } }
		
			NOT = { has_tech = mechanised_infantry is_researching_technology = mechanised_infantry }
			
			else = { always = no }
		}
	}
}

EAI_prioritise_armor_chassis = {
	has_dlc = "No Step Back"

	OR = {
		if = { limit = { EAI_armor_tech_focus = yes }

			OR = {
				if = { limit = { EAI_MARM_tech_focus = yes }
					OR = {
						AND = { date > 1936.1.1 NOT = { has_tech = gwtank_chassis is_researching_technology = gwtank_chassis } }
						AND = { date > 1936.1.1 NOT = { has_tech = basic_medium_tank_chassis is_researching_technology = basic_medium_tank_chassis } }
						AND = { date > 1940.1.1 NOT = { has_tech = improved_medium_tank_chassis is_researching_technology = improved_medium_tank_chassis } }
						AND = { date > 1943.1.1 NOT = { has_tech = advanced_medium_tank_chassis is_researching_technology = advanced_medium_tank_chassis } }
						AND = { date > 1944.1.1 NOT = { has_tech = main_battle_tank_chassis is_researching_technology = main_battle_tank_chassis } }
					}
					else = { always = no }
				}
				if = { limit = { EAI_HARM_tech_focus = yes }
					OR = {
						AND = { date > 1936.1.1 NOT = { has_tech = gwtank_chassis is_researching_technology = gwtank_chassis } }
						AND = { date > 1936.1.1 NOT = { has_tech = basic_heavy_tank_chassis is_researching_technology = basic_heavy_tank_chassis } }
						AND = { date > 1940.1.1 NOT = { has_tech = improved_heavy_tank_chassis is_researching_technology = improved_heavy_tank_chassis } }
						AND = { date > 1943.1.1 NOT = { has_tech = advanced_heavy_tank_chassis is_researching_technology = advanced_heavy_tank_chassis } }
						AND = { date > 1944.1.1 NOT = { has_tech = main_battle_tank_chassis is_researching_technology = main_battle_tank_chassis } }
					}
					else = { always = no }
				}
			}
		}
		else = { always = no }
	}
}

EAI_prioritise_ship_hulls = {
	has_dlc = "Man the Guns"

	OR = {
		if = { limit = { EAI_capital_tech_focus = yes }

			OR = {
				if = { limit = { EAI_CV_tech_focus = yes }
					OR = {
						AND = { date > 1936.1.1 NOT = { has_tech = early_ship_hull_carrier is_researching_technology = early_ship_hull_carrier } }
						AND = { date > 1936.1.1 NOT = { has_tech = basic_ship_hull_carrier is_researching_technology = basic_ship_hull_carrier } }
						AND = { date > 1940.1.1 NOT = { has_tech = improved_ship_hull_carrier is_researching_technology = improved_ship_hull_carrier } }
						AND = { date > 1944.1.1 NOT = { has_tech = advanced_ship_hull_carrier is_researching_technology = advanced_ship_hull_carrier } }
					}
					else = { always = no }
				}
				if = { limit = { EAI_SHBB_tech_focus = yes }
					OR = {
						AND = { date > 1936.1.1 NOT = { has_tech = early_ship_hull_heavy is_researching_technology = early_ship_hull_heavy } }
						AND = { date > 1936.1.1 NOT = { has_tech = basic_ship_hull_heavy is_researching_technology = basic_ship_hull_heavy } }
						AND = { date > 1936.1.1 NOT = { has_tech = ship_hull_super_heavy is_researching_technology = ship_hull_super_heavy } }
					}
					else = { always = no }
				}
				if = { limit = { OR = { EAI_BB_tech_focus = yes EAI_BC_tech_focus = yes } }
					OR = {
						AND = { date > 1936.1.1 NOT = { has_tech = early_ship_hull_heavy is_researching_technology = early_ship_hull_heavy } }
						AND = { date > 1936.1.1 NOT = { has_tech = basic_ship_hull_heavy is_researching_technology = basic_ship_hull_heavy } }
						AND = { date > 1940.1.1 NOT = { has_tech = improved_ship_hull_heavy is_researching_technology = improved_ship_hull_heavy } }
						AND = { date > 1944.1.1 NOT = { has_tech = advanced_ship_hull_heavy is_researching_technology = advanced_ship_hull_heavy } }
					}
					else = { always = no }
				}
			}
		}
		else = { always = no }

		if = { limit = { EAI_screen_tech_focus = yes }

			OR = {
				if = { limit = { OR = { EAI_CA_tech_focus = yes EAI_CL_tech_focus = yes } }
					OR = {
						AND = { date > 1936.1.1 NOT = { has_tech = early_ship_hull_cruiser is_researching_technology = early_ship_hull_cruiser } }
						AND = { date > 1936.1.1 NOT = { has_tech = basic_ship_hull_cruiser is_researching_technology = basic_ship_hull_cruiser } }
						AND = { date > 1940.1.1 NOT = { has_tech = improved_ship_hull_cruiser is_researching_technology = improved_ship_hull_cruiser } }
						AND = { date > 1944.1.1 NOT = { has_tech = advanced_ship_hull_cruiser is_researching_technology = advanced_ship_hull_cruiser } }
					}
					else = { always = no }
				}
				if = { limit = { EAI_DD_tech_focus = yes NOT = { EAI_cheap_DD_tech_focus = yes } }
					OR = {
						AND = { date > 1936.1.1 NOT = { has_tech = early_ship_hull_light is_researching_technology = early_ship_hull_light } }
						AND = { date > 1936.1.1 NOT = { has_tech = basic_ship_hull_light is_researching_technology = basic_ship_hull_light } }
						AND = { date > 1940.1.1 NOT = { has_tech = improved_ship_hull_light is_researching_technology = improved_ship_hull_light } }
						AND = { date > 1944.1.1 NOT = { has_tech = advanced_ship_hull_light is_researching_technology = advanced_ship_hull_light } }
					}
					else = { always = no }
				}
			}
		}
		else = { always = no }

		if = { limit = { check_variable = { EAI_FOCUS/NAVY/naval_doctrine = global.EAI_TI_DOCTRINE } EAI_SS_tech_focus = yes }
			OR= {
				AND = { date > 1936.1.1 NOT = { has_tech = early_ship_hull_submarine is_researching_technology = early_ship_hull_submarine } }
				AND = { date > 1936.1.1 NOT = { has_tech = basic_ship_hull_submarine is_researching_technology = basic_ship_hull_submarine } }
				AND = { date > 1940.1.1 NOT = { has_tech = improved_ship_hull_submarine is_researching_technology = improved_ship_hull_submarine } }
				AND = { date > 1944.1.1 NOT = { has_tech = advanced_ship_hull_submarine is_researching_technology = advanced_ship_hull_submarine } }
			}
		}
		else = { always = no }
	}
}

EAI_prioritise_aircraft = {
	OR = {
		if = { limit = { EAI_FTR_tech_focus = yes }
			OR = {
				AND = { date > 1936.1.1 NOT = { EAI_is_researching_basic_small_airframe = yes } }
				AND = { date > 1940.1.1 NOT = { EAI_is_researching_improved_small_airframe = yes } }
				AND = { date > 1944.1.1 NOT = { EAI_is_researching_advanced_small_airframe = yes } }
			}
			else = { always = no }
		}
		if = { limit = { EAI_HFTR_tech_focus = yes }
			OR = {
				AND = { date > 1936.1.1 NOT = { EAI_is_researching_basic_medium_airframe = yes } }
				AND = { date > 1940.1.1 NOT = { EAI_is_researching_improved_medium_airframe = yes } }
				AND = { date > 1944.1.1 NOT = { EAI_is_researching_advanced_medium_airframe = yes } }
			}
			else = { always = no }
		}
		if = { limit = { EAI_CAS_tech_focus = yes }
			OR = {
				AND = { date > 1936.1.1 NOT = { EAI_is_researching_basic_small_airframe = yes } }
				AND = { date > 1940.1.1 NOT = { EAI_is_researching_improved_small_airframe = yes } }
				AND = { date > 1944.1.1 NOT = { EAI_is_researching_advanced_small_airframe = yes } }
			}
			else = { always = no }
		}
		if = { limit = { EAI_TAC_tech_focus = yes }
			OR = {
				AND = { date > 1936.1.1 NOT = { EAI_is_researching_basic_medium_airframe = yes } }
				AND = { date > 1940.1.1 NOT = { EAI_is_researching_improved_medium_airframe = yes } }
				AND = { date > 1944.1.1 NOT = { EAI_is_researching_advanced_medium_airframe = yes } }
			}
			else = { always = no }
		}
		if = { limit = { EAI_STR_tech_focus = yes }
			OR = {
				AND = { date > 1936.1.1 NOT = { EAI_is_researching_basic_large_airframe = yes } }
				AND = { date > 1940.1.1 NOT = { EAI_is_researching_improved_large_airframe = yes } }
				AND = { date > 1944.1.1 NOT = { EAI_is_researching_advanced_large_airframe = yes } }
			}
			else = { always = no }
		}
	}
}

### Land Doctrines

EAI_land_doctrine_progress_limit = {

	surrender_progress < 0.05
	
	OR = {
		EAI_land_doctrine_cost_reduction_advisor_priority = yes

		EAI_land_doctrine_cost_reduction_spirit_priority = yes
	}

	set_temp_variable = { total_xp = army_experience }
	add_to_temp_variable = { total_xp = EAI_army_xp }
	check_variable = { total_xp < 400 }
}

EAI_land_doctrine_priority = {

	has_army_experience < 150
}

EAI_land_doctrine_mass_assault_priority = {

	NOT = {
		any_enemy_country = { OR = { is_major = yes strength_ratio = { tag = ROOT ratio > 1 } } }
	}

	AND = {
		check_variable = { EAI_FOCUS/LAND/land_doctrine = global.EAI_MA_DOCTRINE }
		
		NOT = { 
			has_tech = vast_offensives 
			has_tech = human_wave_offensive 
		}
	}
}

EAI_land_doctrine_cost_reduction_advisor_priority = {

	OR = {

		###

		AND = { check_variable = { EAI_FOCUS/land/land_doctrine = global.EAI_MW_DOCTRINE }

			OR = {
				has_available_idea_with_traits = { idea = mobile_warfare_expert limit = 1 }
				has_available_idea_with_traits = { idea = blitzkrieg_theorist limit = 1 }
				has_available_idea_with_traits = { idea = military_theorist limit = 1 }
			}
			NOT = {
				has_idea_with_trait = mobile_warfare_expert
				has_idea_with_trait = blitzkrieg_theorist
				has_idea_with_trait = military_theorist
			}
		}

		###

		AND = { check_variable = { EAI_FOCUS/land/land_doctrine = global.EAI_SF_DOCTRINE }

			OR = {
				has_available_idea_with_traits = { idea = superior_firepower_expert limit = 1 }
				has_available_idea_with_traits = { idea = military_theorist limit = 1 }
			}
			NOT = {
				has_idea_with_trait = superior_firepower_expert
				has_idea_with_trait = military_theorist
			}
		}

		###

		AND = { check_variable = { EAI_FOCUS/land/land_doctrine = global.EAI_GB_DOCTRINE }

			OR = {
				has_available_idea_with_traits = { idea = grand_battle_plan_expert limit = 1 }
				has_available_idea_with_traits = { idea = military_theorist limit = 1 }
			}
			NOT = {
				has_idea_with_trait = grand_battle_plan_expert
				has_idea_with_trait = military_theorist
			}
		}

		###

		AND = { check_variable = { EAI_FOCUS/land/land_doctrine = global.EAI_MA_DOCTRINE }

			OR = {
				has_available_idea_with_traits = { idea = mass_assault_expert limit = 1 }
				has_available_idea_with_traits = { idea = military_theorist limit = 1 }
			}
			NOT = {
				has_idea_with_trait = mass_assault_expert
				has_idea_with_trait = military_theorist
			}
		}
	}
}

EAI_land_doctrine_cost_reduction_spirit_priority = {

	always = no

	NOT = { has_idea = professional_officer_corps_spirit }
}

### Naval Doctrines

EAI_naval_doctrine_progress_limit = {
	
	check_variable = { var = EAI_naval_doctrines_researched value = global.EAI_years_elapsed compare = greater_than_or_equals }

	set_temp_variable = { total_xp = navy_experience }
	add_to_temp_variable = { total_xp = EAI_navy_xp }
	check_variable = { total_xp < 200 }
}

### Air Doctrines

EAI_air_doctrine_progress_limit = {

	set_temp_variable = { total_xp = air_experience }
	add_to_temp_variable = { total_xp = EAI_air_xp }
	check_variable = { total_xp < 400 }

	OR = {

		AND = {
			set_temp_variable = { temp = global.EAI_years_elapsed }
			multiply_temp_variable = { temp = 2 }
			check_variable = { var = EAI_air_doctrines_researched value = temp compare = greater_than_or_equals }
		}

		AND = {
			NOT = { EAI_fighter_developed = yes }
		}

		AND = { EAI_FTR_aircraft_production = yes NOT = { has_design_based_on = small_plane_airframe } }
		AND = { EAI_HFTR_aircraft_production = yes NOT = { has_design_based_on = medium_plane_fighter_airframe } }
		AND = { EAI_CAS_aircraft_production = yes NOT = { has_design_based_on = small_plane_cas_airframe } }
		AND = { EAI_TAC_aircraft_production = yes NOT = { has_design_based_on = medium_plane_airframe } }
		AND = { EAI_NAV_aircraft_production = yes NOT = { has_design_based_on = small_plane_naval_bomber_airframe } }
		AND = { EAI_MAR_aircraft_production = yes NOT = { has_design_based_on = large_plane_maritime_patrol_plane_airframe } }
		AND = { EAI_STR_aircraft_production = yes NOT = { has_design_based_on = large_plane_airframe } }
		AND = { EAI_CV_aircraft_production = yes NOT = { has_design_based_on = cv_small_plane_airframe has_design_based_on = cv_small_plane_naval_bomber_airframe } }
	}
}

EAI_air_doctrine_SD_priority = {

	OR = {
		NOT = { has_tech = logistical_bombing }
		has_air_experience > 200
	}
}

EAI_air_doctrine_BFS_priority = {

	OR = {
		NOT = { has_tech = ground_support_integration }
		NOT = { has_tech = battlefield_support }
		has_air_experience > 200
	}
}

EAI_air_doctrine_OI_priority = {

	OR = {
		NOT = { has_tech = fighter_veteran_initiative }
		NOT = { has_tech = cas_veteran_initiative }
		has_air_experience > 200
	}
}

### special tech bonus checks

EAI_armor_tech_bonus = {
	OR = {
		AND = {
			original_tag = GER
			OR = { has_opinion_modifier = sov_ger_treaty_trade has_completed_focus = GER_army_innovation_2 }
		}
		AND = {
			original_tag = SOV
			OR = { has_opinion_modifier = sov_ger_treaty_trade has_completed_focus = SOV_lessons_of_war }
		}
		AND = {
			original_tag = FRA
			OR = {
				AND = { check_variable = { EAI_FOCUS/LAND/antitank_design = global.EAI_HTD_AT_DESIGN } has_completed_focus = FRA_heavy_armor_focus }
				AND = { check_variable = { EAI_FOCUS/LAND/antitank_design = global.EAI_MTD_AT_DESIGN } has_completed_focus = FRA_light_medium_armor }
			}
		}
		AND = {
			original_tag = ENG
			has_completed_focus = ENG_tank_focus
		}
		# AND = {
		# 	original_tag = ITA
		# 	OR = {
		# 		has_completed_focus = ITA_armored_effort
		# 		has_completed_focus = ITA_german_rd_treaty
		# 	}
		# }
	}
}

EAI_armor_tech_bonus_2 = {
	OR = {
		AND = {
			original_tag = GER
			has_completed_focus = GER_army_innovation_2
		}
	}
}

EAI_GER_SOV_armor_tech_bonus = {
	OR = {
		AND = {
			original_tag = GER
			OR = { has_opinion_modifier = sov_ger_treaty_trade has_completed_focus = GER_army_innovation_2 }
		}
		AND = {
			original_tag = SOV
			OR = { has_opinion_modifier = sov_ger_treaty_trade has_completed_focus = SOV_lessons_of_war }
		}
	}
}

EAI_fighter_tech_bonus = {
	NOT = { has_global_flag = EAI_historical_mode }
	OR = {
		AND = { original_tag = ENG has_completed_focus = fighter_command_focus }
		#AND = { original_tag = ITA has_completed_focus = ITA_air_innovation_2 }
		#AND = { original_tag = JAP has_completed_focus = JAP_fighter_modernization }
	}
}

EAI_carrier_tech_bonus = {
	OR = {
		AND = { original_tag = ENG has_completed_focus = uk_carrier_focus }
		AND = { original_tag = USA has_completed_focus = USA_carrier_primacy }
	}
}

EAI_use_tech_bonus_on_construction_tech = {

	OR = {

		AND ={
			tag = GER
			has_completed_focus = GER_four_year_plan
			NOT = { 
				is_researching_technology = construction1 has_tech = construction1
				is_researching_technology = construction2 has_tech = construction2
				is_researching_technology = construction3 has_tech = construction3
			}
		}
	}
}