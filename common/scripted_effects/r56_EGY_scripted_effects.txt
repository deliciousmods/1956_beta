
########### Treaty influences mechanics ###############

######################### Egyptian Modifiers ############################
#Increase#
EGY_egyptian_treaty_influence_low_increase_effect = {
	custom_effect_tooltip = EGY_egypt_tt
	custom_effect_tooltip = EGY_treaty_influence_low_increase_tt
	add_to_variable = { var = EGY_egyptian_treaty_influence value = EGY_treaty_influence_low_increase }
	clamp_variable = {
		var = EGY_egyptian_treaty_influence
		min = 0
		max = 100
	}
}

EGY_egyptian_treaty_influence_medium_increase_effect = {
	custom_effect_tooltip = EGY_egypt_tt
	custom_effect_tooltip = EGY_treaty_influence_medium_increase_tt
	add_to_variable = { var = EGY_egyptian_treaty_influence value = EGY_treaty_influence_medium_increase }
	clamp_variable = {
		var = EGY_egyptian_treaty_influence
		min = 0
		max = 100
	}
}

EGY_egyptian_treaty_influence_high_increase_effect = {
	custom_effect_tooltip = EGY_egypt_tt
	custom_effect_tooltip = EGY_treaty_influence_high_increase_tt
	add_to_variable = { var = EGY_egyptian_treaty_influence value = EGY_treaty_influence_high_increase }
	clamp_variable = {
		var = EGY_egyptian_treaty_influence
		min = 0
		max = 100
	}
}

#Decrease#
EGY_egyptian_treaty_influence_low_decrease_effect = {
	custom_effect_tooltip = EGY_egypt_tt
	custom_effect_tooltip = EGY_treaty_influence_low_decrease_tt
	add_to_variable = { var = EGY_egyptian_treaty_influence value = EGY_treaty_influence_low_decrease }
	clamp_variable = {
		var = EGY_egyptian_treaty_influence
		min = 0
		max = 100
	}
}

EGY_egyptian_treaty_influence_medium_decrease_effect = {
	custom_effect_tooltip = EGY_egypt_tt
	custom_effect_tooltip = EGY_treaty_influence_medium_decrease_tt
	add_to_variable = { var = EGY_egyptian_treaty_influence value = EGY_treaty_influence_medium_decrease }
	clamp_variable = {
		var = EGY_egyptian_treaty_influence
		min = 0
		max = 100
	}
}

EGY_egyptian_treaty_influence_high_decrease_effect = {
	custom_effect_tooltip = EGY_egypt_tt
	custom_effect_tooltip = EGY_treaty_influence_high_decrease_tt
	add_to_variable = { var = EGY_egyptian_treaty_influence value = EGY_treaty_influence_high_decrease }
	clamp_variable = {
		var = EGY_egyptian_treaty_influence
		min = 0
		max = 100
	}
}


######################### British Modifiers ###########################
#Increase#																			
EGY_british_treaty_influence_low_increase_effect = {
	custom_effect_tooltip = EGY_britain_tt
	custom_effect_tooltip = EGY_treaty_influence_low_increase_tt
	add_to_variable = { var = EGY_british_treaty_influence value = EGY_treaty_influence_low_increase }
	clamp_variable = {
		var = EGY_british_treaty_influence
		min = 0
		max = 100
	}
}

EGY_british_treaty_influence_medium_increase_effect = {
	custom_effect_tooltip = EGY_britain_tt
	custom_effect_tooltip = EGY_treaty_influence_medium_increase_tt
	add_to_variable = { var = EGY_british_treaty_influence value = EGY_treaty_influence_medium_increase }
	clamp_variable = {
		var = EGY_british_treaty_influence
		min = 0
		max = 100
	}
}

EGY_british_treaty_influence_high_increase_effect = {
	custom_effect_tooltip = EGY_britain_tt
	custom_effect_tooltip = EGY_treaty_influence_high_increase_tt
	add_to_variable = { var = EGY_british_treaty_influence value = EGY_treaty_influence_high_increase }
	clamp_variable = {
		var = EGY_british_treaty_influence
		min = 0
		max = 100
	}
}


EGY_lower_sudanese_serparatists = {
	if = {
		limit = {
			THIS = {
				has_dynamic_modifier = { modifier = EGY_moderate_sudanese_separatism }
			}
		}
		custom_effect_tooltip = EGY_lower_sudanese_separatism_tt
		hidden_effect = {
			THIS = {
				remove_dynamic_modifier = { modifier = EGY_moderate_sudanese_separatism } 
				add_dynamic_modifier = { modifier = EGY_mild_sudanese_separatism }
			}
		}
	}
	if = {
		limit = {
			THIS = {
				has_dynamic_modifier = { modifier = EGY_fierce_sudanese_separatism }
			}
		}
		custom_effect_tooltip =  EGY_lower_sudanese_separatism_tt
		hidden_effect = { 
			THIS = {
				remove_dynamic_modifier = { modifier = EGY_fierce_sudanese_separatism } 
				add_dynamic_modifier = { modifier = EGY_moderate_sudanese_separatism }
			}
		}
	}
}

EGY_raise_sudanese_serparatists = {
	if = {
		limit = {
			THIS = {
				has_dynamic_modifier = { modifier = EGY_moderate_sudanese_separatism }
			}
		}
		custom_effect_tooltip = EGY_raise_sudanese_separatism_tt
		hidden_effect = { 
			THIS = { 
				remove_dynamic_modifier = { modifier = EGY_moderate_sudanese_separatism } 
				add_dynamic_modifier = { modifier = EGY_fierce_sudanese_separatism }
			}
		}
	}
	if = {
		limit = {
			THIS = {
				has_dynamic_modifier = { modifier = EGY_mild_sudanese_separatism }
			}
		}
		custom_effect_tooltip = EGY_raise_sudanese_separatism_tt
		hidden_effect = { 
			THIS = {
				remove_dynamic_modifier = { modifier = EGY_mild_sudanese_separatism } 
				add_dynamic_modifier = { modifier = EGY_moderate_sudanese_separatism }
			}
		}
	}
}

EGY_remove_sudanese_separatism = {
	clr_state_flag = EGY_sudanese_separatism_flag
	if = {
		limit = {
			THIS = {
				has_dynamic_modifier = { modifier = EGY_fierce_sudanese_separatism }
			}
		}
		custom_effect_tooltip = EGY_remove_sudanese_separatism_tt
		hidden_effect = { 
			THIS = { 
				remove_dynamic_modifier = { modifier = EGY_fierce_sudanese_separatism } 
			}
		}
	}
	if = {
		limit = {
			THIS = {
				has_dynamic_modifier = { modifier = EGY_moderate_sudanese_separatism }
			}
		}
		custom_effect_tooltip = EGY_remove_sudanese_separatism_tt
		hidden_effect = { 
			THIS = { 
				remove_dynamic_modifier = { modifier = EGY_moderate_sudanese_separatism } 
			}
		}
	}
	if = {
		limit = {
			THIS = {
				has_dynamic_modifier = { modifier = EGY_mild_sudanese_separatism }
			}
		}
		custom_effect_tooltip = EGY_remove_sudanese_separatism_tt
		hidden_effect = { 
			THIS = {
				remove_dynamic_modifier = { modifier = EGY_mild_sudanese_separatism } 
			}
		}
	}
}

# Sudanese Elections

EGY_calculate_elections_chance = {
    set_temp_variable = {
        EGY_sum_chance = 0
    }
    set_temp_variable = {
        EGY_divide_by = 100
    }
    add_to_temp_variable = { sum_odds = EGY_integration_chance }
    add_to_temp_variable = { sum_odds = EGY_autonomy_chance }
    add_to_temp_variable = { sum_odds = EGY_independence_chance }
    divide_temp_variable = {
        divide_by = EGY_sum_chance
    }
    multiply_variable = {
        EGY_integration_chance = divide_by
    }
    multiply_variable = {
        EGY_autonomy_chance = divide_by
    }
    multiply_variable = {
        EGY_independence_chance = divide_by
    }
}
EGY_add_integration_chance = {
    add_to_variable = {
        EGY_integration_chance = EGY_integration_chance_add
    }
    set_temp_variable = {
        EGY_integration_chance_calc = EGY_integration_chance_add
    }
    divide_temp_variable = {
        EGY_integration_chance_calc = 2
    }
    subtract_from_variable = {
        EGY_autonomy_chance = EGY_integration_chance_calc
    }
    subtract_from_variable = {
        EGY_independence_chance = EGY_integration_chance_calc
    }
	set_variable = {
		EGY_integration_chance_add = 0
	}
}
EGY_add_autonomy_chance = {
    add_to_variable = {
        EGY_autonomy_chance = EGY_autonomy_chance_add
    }
    set_temp_variable = {
        EGY_autonomy_chance_calc = EGY_autonomy_chance_add
    }
    divide_temp_variable = {
        EGY_autonomy_chance_calc = 2
    }
    subtract_from_variable = {
        EGY_integration_chance = EGY_autonomy_chance_calc
    }
    subtract_from_variable = {
        EGY_independence_chance = EGY_autonomy_chance_calc
    }
	set_variable = {
		EGY_autonomy_chance_add = 0
	}
}

# Fascist civil war unit distrubution

EGY_assign_fascist_units = {
	if = {
		limit = {
			THIS = {
				has_state_flag = EGY_fascist_headquarters
			}
		}
		hidden_effect = { 
			create_unit = {
				division = "name = \"'Ansar Al'iikhwan\" division_template = \"'Ansar Al'iikhwan\" start_experience_factor = 0.1 start_equipment_factor = 0.6 force_equipment_variants = { infantry_equipment_0 = { owner = EGY } }"
				owner = EGY
			}
			create_unit = {
				division = "name = \"'Ansar Al'iikhwan\" division_template = \"'Ansar Al'iikhwan\" start_experience_factor = 0.1 start_equipment_factor = 0.6 force_equipment_variants = { infantry_equipment_0 = { owner = EGY } }"
				owner = EGY
			}
		}
	}
	if = {
		limit = {
			THIS = {
				has_state_flag = EGY_fascist_state
				NOT = {
					has_state_flag = EGY_sudanese_separatism_flag
				}
			}
		}
		hidden_effect = { 
			create_unit = {
				division = "name = \"'Ansar Al'iikhwan\" division_template = \"'Ansar Al'iikhwan\" start_experience_factor = 0.1 start_equipment_factor = 0.6 force_equipment_variants = { infantry_equipment_0 = { owner = EGY } }"
				owner = EGY
			}
		}
	}
	if = {
		limit = {
			THIS = {
				AND = {
					has_state_flag = EGY_fascist_state
					has_state_flag = EGY_sudanese_separatism_flag
				}
			}
		}
		hidden_effect = {
			EGY_remove_sudanese_separatism = yes
			create_unit = {
				division = "name = \"'Ansar Sudaniuwn'\" division_template = \"'Ansar Sudaniuwn\" start_experience_factor = 0.1 start_equipment_factor = 0.5 force_equipment_variants = { infantry_equipment_0 = { owner = EGY } }"
				owner = EGY
			}
		}
	}
}

EGY_fire_civil_war = {
	if = {
		limit = {
			456 = {
				has_state_flag = EGY_fascist_headquarters
			}
		}
		start_civil_war = {
			ruling_party = fascism
			ideology = neutrality
			size = 1
			capital = 907
			keep_unit_leaders_trigger = {
				has_trait = EGY_brotherhood_sympathiser
			}
			states = all
			states_filter = {
				NOT = {
					has_state_flag = EGY_fascist_state
				}
			}
		}
	}
	if = {
		limit = {
			453 = {
				has_state_flag = EGY_fascist_headquarters
			}
		}
		start_civil_war = {
			ruling_party = fascism
			ideology = neutrality
			size = 1
			capital = 907
			keep_unit_leaders_trigger = {
				has_trait = EGY_brotherhood_sympathiser
			}
			states = all
			states_filter = {
				NOT = {
					has_state_flag = EGY_fascist_state
				}
			}
		}
	}
}

EGY_pacify_the_sudanese_effect = {
	if = {
		limit = {
			THIS = {
				has_dynamic_modifier = {
					modifier = EGY_mild_sudanese_separatism
				}
			}
		}
		add_manpower = -2500
		add_equipment_to_stockpile = {
			type = infantry_equipment
			amount = -250
			producer = EGY
		}
	}
	else_if = {
		limit = {
			THIS = {
				has_dynamic_modifier = {
					modifier = EGY_moderate_sudanese_separatism
				}
			}
		}
		add_manpower = -5000
		add_equipment_to_stockpile = {
			type = infantry_equipment
			amount = -500
			producer = EGY
		}
	}
	else_if = {
		limit = {
			THIS = {
				has_dynamic_modifier = {
					modifier = EGY_fierce_sudanese_separatism
				}
			}
		}
		add_manpower = -10000
		add_equipment_to_stockpile = {
			type = infantry_equipment
			amount = -1000
			producer = EGY
		}
	}
	custom_effect_tooltip = EGY_pacification_cost_change
}